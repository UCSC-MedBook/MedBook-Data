<template name="editSubmission">
  {{print "editSubmission this:" this}}

  {{#if this}} {{! if no data, invalid WranglerDocuments _id in URL }}

    {{> addFiles}}

    <hr />

    {{! TODO: add objects manually}}

    {{#if hasDocuments}}
      {{#if classifySubmissionType this._id}}
        {{> reviewWranglerDocuments}}
        <hr />
        {{> optionsAndSubmit}}
      {{else}}
        <span class="help-block">
          Multiple submission types detected:
          <ul>
            {{#each getDocumentTypes}}
              <li>{{this}}</li>
            {{/each}}
          </ul>
          Please submit each type of new document seperately.
        </span>
      {{/if}}
    {{else}}
      <span class="help-block">Add files or objects to continue</span>
    {{/if}}
    {{> lastSubmissionErrors}}
  {{else}}
    {{! loading handled in the router }}
    {{> pageNotFound}}
  {{/if}}
</template>

<template name="addFiles">
  <h2>Add files</h2>
  <div class="row click-outside-to-unselect">
    <div class="col-md-8">
      <ul class="list-group">
        {{#each getFiles}}
          <li class="list-group-item edit-this-file
              {{fileContextualClass}}
              {{activeClass}}">
            <h5 class="list-group-item-heading"> {{! what a large h5...}}
              <i class="glyphicon glyphicon-file"></i>

              {{file_name}}

              <span class="pull-right">
                <span class="badge">{{status}}</span>
                <button class="remove-this-file btn btn-xs btn-warning">
                  <span class="sr-only">Remove file</span>
                  <span class="glyphicon glyphicon-trash"></span>
                </button>
              </span>
            </h5>

            {{#if isDefined manual_file_type}}
              <p class="list-group-item-text">
                <span class="blank-glyphicon-to-left">
                  Forced file type: {{manual_file_type}}
                </span>
              </p>
            {{/if}}

            {{#if compare status "error"}}
              <p class="list-group-item-text">
                <span class="blank-glyphicon-to-left">
                  Error: {{error_description}}
                </span>
              </p>
            {{/if}}
          </li>
        {{/each}}

        {{> uploadFilesListItem}}
      </ul>
    </div>

    {{#if isDefined editing_file}}
      <div class="col-md-4">
        {{> editFileType}}
      </div>
    {{/if}}

  </div>
</template>

<template name="uploadFilesListItem">
  {{! the last list item: for adding files/objects}}
  <li class="list-group-item">
    <div class="row">
      {{! upload local files}}
      <div class="col-xs-6">
        <span class="btn btn-default btn-file fill-width">
          Upload local files
          <input id="upload-files-input" type="file" multiple>
        </span>
      </div>

      {{! add from the web}}
      <div class="col-xs-6">
        <form class="add-from-web-form">
          <div class="input-group">
            <input name="urlInput" type="text" class="form-control"
                placeholder="Enter URL">
            <span class="input-group-btn">
              <button class="btn btn-default" type="submit">
                Add
              </button>
            </span>
          </div>
        </form>
      </div>

      {{! add manually}}
      <!-- <div class="col-md-4 btn-group display-block">
        <button class="btn btn-default dropdown-toggle fill-width"
            type="button" data-toggle="dropdown"
            aria-haspopup="true" aria-expanded="false">
          Add manually <span class="caret"></span>
        </button>
        <ul class="dropdown-menu">
          <li class="add-superpathway"><a href="#">Superpathway</a></li>
          <li><a href="#">Another action</a></li>
          <li class="disabled"><a href="#">Something else here</a></li>
          <li role="separator" class="divider"></li>
          <li><a href="#">Separated link</a></li>
        </ul>
      </div> -->
    </div>
  </li>
</template>

<template name="editFileType">
  {{#autoForm id="edit-file" schema=fileTypeSchema doc=currentEditingFile}}
    {{> afQuickField name="manual_file_type" options="allowed"
        firstOption="Auto"}}
    <div class="form-group">
      <button type="submit" class="btn btn-primary">
        Apply
      </button>
    </div>
  {{/autoForm}}
</template>

<template name="lastSubmissionErrors">
  {{#if hasErrors}}
  <hr />
    <h2>Errors as of last submission</h2>
    <ul>
      {{#each errors}}
        <li>{{this}}</li>
      {{/each}}
    </ul>
  {{/if}}
</template>
